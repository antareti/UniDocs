<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор документов от HACKPACK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        #message-box { transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
        .preview-container { transition: all 0.3s ease-in-out; filter: blur(5px); opacity: 0.5; transform: scale(0.98); }
        .preview-container.visible { filter: blur(0); opacity: 1; transform: scale(1); }
        .loading-img { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: .5; } }
        @media print { body { background-color: #fff; } .no-print { display: none; } }
        #subscription-modal { transition: opacity 0.3s ease-in-out; }
    </style>
</head>
<body class="text-gray-800">

<div class="flex flex-col lg:flex-row w-full min-h-screen">
    <!-- Левый блок управления -->
    <div class="w-full lg:w-1/3 bg-white p-6 lg:p-8 shadow-lg no-print">
        <div class="flex items-center mb-6">
            <img src="https://placehold.co/48x48/111/fff?text=H" alt="HACKPACK Logo" class="h-12 w-12 mr-4">
            <h1 class="text-2xl font-bold">Генератор документов от HACKPACK</h1>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-600">Название университета</label>
                <input type="text" id="college-name" readonly class="mt-1 block w-full bg-gray-200 border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none sm:text-sm text-gray-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-600">Имя студента</label>
                <input type="text" id="student-name" readonly class="mt-1 block w-full bg-gray-200 border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none sm:text-sm text-gray-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-600">Номер зачетной книжки</label>
                <input type="text" id="enrollment-no" readonly class="mt-1 block w-full bg-gray-200 border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none sm:text-sm text-gray-500">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-600">Специальность</label>
                <input type="text" id="program-name" readonly class="mt-1 block w-full bg-gray-200 border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none sm:text-sm text-gray-500">
            </div>
        </div>

        <div class="mt-8 space-y-3">
            <button id="generate-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-4 rounded-lg flex items-center justify-center space-x-2 transition-colors duration-200">
                <svg id="spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span id="btn-text">Сгенерировать документы</span>
            </button>
            <button id="save-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-4 rounded-lg flex items-center justify-center space-x-2 transition-colors duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                <span>Сохранить все документы (.zip)</span>
            </button>
            <div id="status-text" class="text-center text-gray-500 text-sm h-5"></div>
        </div>
    </div>

    <!-- Правый блок предпросмотра -->
    <div class="w-full lg:w-2/3 bg-gray-100 p-6 lg:p-8 overflow-y-auto">
        <h2 class="text-xl font-bold mb-6">Предпросмотр документов</h2>
        <div id="previews-wrapper" class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
            <div id="preview-id-card-wrapper" class="preview-container">
                <h3 class="font-semibold mb-2">CARTÃO DE IDENTIFICAÇÃO</h3>
                <div id="id-card-content" class="relative bg-gray-50 p-4 rounded-lg shadow-md max-w-sm mx-auto h-[180px] flex items-center justify-start space-x-4">
                    <div class="absolute top-3 left-4 flex items-center space-x-2">
                        <img id="id-card-logo" src="https://placehold.co/32x32/111/fff?text=H" class="rounded-full w-8 h-8 object-contain" alt="Логотип HACKPACK">
                        <h4 id="id-card-university" class="font-bold text-base text-gray-700"></h4>
                    </div>
                    <img src="https://placehold.co/40x40/111/fff?text=S" class="absolute top-3 right-4 opacity-20 w-10 h-10 object-contain" alt="Печать HACKPACK">
                    <img id="id-card-photo" src="https://placehold.co/80x100/E2E8F0/4A5568?text=Фото" class="w-20 h-24 rounded-md border border-gray-300 object-cover mt-8 ml-4" alt="Фото студента">
                    <div class="flex flex-col text-[10px] text-gray-700 mt-8">
                        <p class="mb-1"><strong>N.º DE MATRÍCULA</strong> <span id="id-card-enroll" class="font-medium"></span></p>
                        <p class="mb-1"><strong>NOME</strong> <span id="id-card-name" class="font-semibold text-xs"></span></p>
                        <p class="mb-1"><strong>CURSO</strong> <span id="id-card-program" class="font-medium"></span></p>
                        <div class="flex justify-between w-full mt-2">
                            <p><strong>DATA DE NASCIMENTO</strong> <span id="id-card-dob" class="font-medium"></span></p>
                            <p><strong>VÁLIDO ATÉ</strong> <span id="id-card-valid-thru" class="font-medium"></span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="preview-data-file-wrapper" class="preview-container">
                <h3 class="font-semibold mb-2">Ficheiro de Dados (info.txt)</h3>
                <div class="bg-gray-800 text-white p-4 rounded-lg shadow-md font-mono text-xs">
                    <pre id="data-file-content"></pre>
                </div>
            </div>

            <div id="preview-fee-receipt-wrapper" class="preview-container">
                <h3 class="font-semibold mb-2">RECIBO DE PROPINAS</h3>
                <div id="fee-receipt-content" class="bg-white p-8 rounded-lg shadow-md max-w-md mx-auto relative">
                    <div class="text-center mb-8">
                        <img id="receipt-logo" src="https://placehold.co/64x64/111/fff?text=H" class="h-16 mx-auto mb-4 object-contain" alt="Логотип HACKPACK">
                        <h4 id="receipt-university" class="font-bold text-xl"></h4>
                        <p class="text-sm text-gray-500">RECIBO DE PROPINAS</p>
                    </div>
                    <div class="flex justify-between text-sm mb-6">
                        <div>
                            <p><strong>Data:</strong> <span id="receipt-date"></span></p>
                            <p><strong>N.º de Matrícula:</strong> <span id="receipt-enroll"></span></p>
                        </div>
                        <div>
                            <p><strong>Nome:</strong> <span id="receipt-name"></span></p>
                            <p><strong>Curso:</strong> <span id="receipt-program"></span></p>
                        </div>
                    </div>
                    <div class="border-t border-b border-gray-300 py-4 mb-4">
                        <h5 class="text-sm font-semibold mb-2">Finalidade do Pagamento:</h5>
                        <p class="text-xs">Propinas e outras taxas para o semestre de 2024-2025.</p>
                    </div>
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b-2 border-t">
                                <th class="text-left py-2">Detalhamento</th>
                                <th class="text-right py-2">Mont
